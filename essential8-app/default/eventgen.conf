############################################
# ASD Essential 8 Event Gen
# Domenico Perre 
#
# v0.01 Initial Deployment 19/04/2017
#
############################################


#### Applocker Eventgen
[whitelist.sample]
index = wineventlog
source = XmlWinEventLog:Microsoft-Windows-AppLocker/EXE and DLL
sourcetype = XmlWinEventLog:Microsoft-Windows-AppLocker/EXE and DLL
interval = 1
outputMode = splunkstream
splunkHost = localhost
splunkUser = admin
splunkPass = rC47mcHtNN4%
breaker = ^[\r\n]*
## Generate all events in sample
count = 1
earliest = -5m
latest = now
#randomizeCount = 0.8
#randomizeEvents = true

## replace timestamp 2010-06-16 18:35:22:743
token.0.token = (\d{4}\-\d{2}\-\d{2}\w\d{2}:\d{2}:\d{2}\.\d+\w)
token.0.replacementType = timestamp
token.0.replacement = %Y-%m-%d %H:%M:%S

## replace EventRecordID
token.1.token = EventRecordID\>(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

## Moving the stanza below to exclude renaming anomalous eventtypes
## replace ComputerName:
token.2.token = Computer\>([^\<]+)
token.2.replacementType = file
token.2.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

#File Hash
token.3.token = FileHash\>([^\<]+)
token.3.replacementType = mvfile
token.3.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/applocker-file-hash-cert.csv:1

#File Path
token.4.token = FilePath\>([^\<]+)
token.4.replacementType = mvfile
token.4.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/applocker-file-hash-cert.csv:2

#Cert Issuer
token.5.token = Fqbn\>([^\<]+)
token.5.replacementType = mvfile
token.5.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/applocker-file-hash-cert.csv:3

#Replace Username
token.6.token = TargetUser\>([^\<]+)
token.6.replacementType = file
token.6.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/usernames.sample

#Replace Hostname
host.token =Computer\>([^\<]+)

########################################################################################

[whitelist-audit.sample]
#disable = true
index = wineventlog
source = XmlWinEventLog:Microsoft-Windows-AppLocker/EXE and DLL
sourcetype = XmlWinEventLog:Microsoft-Windows-AppLocker/EXE and DLL
interval = 23
outputMode = splunkstream
splunkHost = localhost
splunkUser = admin
splunkPass = rC47mcHtNN4%
breaker = ^[\r\n]*
## Generate all events in sample
count = 1
earliest = -5m
latest = now
#randomizeCount = 0.2
#randomizeEvents = true

## replace timestamp 2010-06-16 18:35:22:743
token.0.token = (\d{4}\-\d{2}\-\d{2}\w\d{2}:\d{2}:\d{2}\.\d+\w)
token.0.replacementType = timestamp
token.0.replacement = %Y-%m-%d %H:%M:%S

## replace EventRecordID
token.1.token = EventRecordID\>(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

## Moving the stanza below to exclude renaming anomalous eventtypes
## replace ComputerName:
token.2.token = Computer\>([^\<]+)
token.2.replacementType = file
token.2.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

#File Hash
token.3.token = FileHash\>([^\<]+)
token.3.replacementType = mvfile
token.3.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-audit.sample:1

#File Path
token.4.token = FilePath\>([^\<]+)
token.4.replacementType = mvfile
token.4.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-audit.sample:3

#Cert Issuer
token.5.token = Fqbn\>([^\<]+)
token.5.replacementType = mvfile
token.5.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-audit.sample:4

#Replace Username
token.6.token = TargetUser\>([^\<]+)
token.6.replacementType = mvfile
token.6.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-audit.sample:2

#Replace Hostname
host.token =Computer\>([^\<]+)

########################################################################################


[whitelist-block.sample]
#disable = true
index = wineventlog
source = XmlWinEventLog:Microsoft-Windows-AppLocker/EXE and DLL
sourcetype = XmlWinEventLog:Microsoft-Windows-AppLocker/EXE and DLL
interval = 20
outputMode = splunkstream
splunkHost = localhost
splunkUser = admin
splunkPass = rC47mcHtNN4%
breaker = ^[\r\n]*
## Generate all events in sample
count = 1
earliest = -5m
latest = now
#randomizeCount = 0.1
#randomizeEvents = true

## replace timestamp 2010-06-16 18:35:22:743
token.0.token = (\d{4}\-\d{2}\-\d{2}\w\d{2}:\d{2}:\d{2}\.\d+\w)
token.0.replacementType = timestamp
token.0.replacement = %Y-%m-%d %H:%M:%S

## replace EventRecordID
token.1.token = EventRecordID\>(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

## Moving the stanza below to exclude renaming anomalous eventtypes
## replace ComputerName:
token.2.token = Computer\>([^\<]+)
token.2.replacementType = file
token.2.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

#File Hash
token.3.token = FileHash\>([^\<]+)
token.3.replacementType = mvfile
token.3.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-block.sample:1

#File Path
token.4.token = FilePath\>([^\<]+)
token.4.replacementType = mvfile
token.4.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-block.sample:3

#Cert Issuer
token.5.token = Fqbn\>([^\<]+)
token.5.replacementType = mvfile
token.5.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-block.sample:4

#Replace Username
token.6.token = TargetUser\>([^\<]+)
token.6.replacementType = mvfile
token.6.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-block.sample:2


#Replace Hostname
host.token =Computer\>([^\<]+)

########################################################################################

[4674.windows]
index = wineventlog
sourcetype = WinEventLog:Security
breaker = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
interval = 30
count = 10
earliest = -5m
latest = now

## replace timestamp 03/11/10 01:12:01 PM
token.0.token = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
token.0.replacementType = timestamp
token.0.replacement = %m/%d/%Y %I:%M:%S %p

## replace @@RecordNumber
token.1.token = RecordNumber=(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

token.4.token = ComputerName=(\S+)
token.4.replacementType = file
token.4.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

token.5.token = Security ID:\s*(\S*)\s*
token.5.replacementType = mvfile
token.5.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/admins.sample:1

token.6.token = Account Name:\s*(\S*)\s*
token.6.replacementType = mvfile
token.6.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/admins.sample:2

[4674.failure.windows]
index = wineventlog
sourcetype = WinEventLog:Security
breaker = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
interval = 30
count = 10
earliest = -5m
latest = now

## replace timestamp 03/11/10 01:12:01 PM
token.0.token = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
token.0.replacementType = timestamp
token.0.replacement = %m/%d/%Y %I:%M:%S %p

## replace @@RecordNumber
token.1.token = RecordNumber=(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

token.4.token = ComputerName=(\S+)
token.4.replacementType = file
token.4.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

token.5.token = Security ID:\s*(\S*)\s*
token.5.replacementType = static
token.5.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-admins.sample:1

token.6.token = Account Name:\s*(\S*)\s*
token.6.replacementType = mvfile
token.6.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/anomolous-admins.sample:2

[Security.4672.windows]
index = wineventlog
sourcetype = WinEventLog:Security
breaker = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
interval = 30
count = 10
earliest = -5m
latest = now
#disabled = true

## replace timestamp 03/11/10 01:12:01 PM
token.0.token = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
token.0.replacementType = timestamp
token.0.replacement = %m/%d/%Y %I:%M:%S %p

## replace @@RecordNumber
token.1.token = RecordNumber=(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

token.3.token = Account Domain:\s*(\S*)\s*
token.3.replacementType = static
token.3.replacement = ESSENTIAL8

token.4.token = ComputerName=(\S+)
token.4.replacementType = file
token.4.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

token.5.token = Security ID:\s*(\S*)\s*
token.5.replacementType = mvfile
token.5.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/admins.sample:1

token.6.token = Account Name:\s*(\S*)\s*
token.6.replacementType = mvfile
token.6.replacement = $SPLUNK_HOME/etc/apps/essential8-app/samples/admins.sample:2

[4673.xml.windows]
index = wineventlog
source = XmlWinEventLog:Security
sourcetype = XmlWinEventLog:Security
interval = 300
#outputMode = modinput
outputMode = splunkstream
splunkHost = localhost
splunkUser = admin
splunkPass = rC47mcHtNN4%

## Generate all events in sample
count = 0
earliest = -5m
latest = now

## replace timestamp 2010-06-16 18:35:22:743
token.0.token = (\d{4}\-\d{2}\-\d{2}\w\d{2}:\d{2}:\d{2}\.\d+\w)
token.0.replacementType = timestamp
token.0.replacement = %Y-%m-%d %H:%M:%S

## replace EventRecordID
token.1.token = EventRecordID\>(\d+)
token.1.replacementType = random
token.1.replacement = integer[0:999999999]

## Moving the stanza below to exclude renaming anomalous eventtypes
## replace ComputerName:
token.2.token = Computer\>([^\<]+)
token.2.replacementType = file
token.2.replacement = $SPLUNK_HOME/etc/apps/SA-Eventgen/samples/hostname.sample

#Replace Username
token.3.token = SubjectUserSid\>([^\<]+)
token.3.replacementType = static
token.3.replacement = lc34

#Replace Username
token.4.token = SubjectUserName\>([^\<]+)
token.4.replacementType = static
token.4.replacement = lc34

[Group_Changes.txt]
disabled = 0
interval = 600
earliest = -10m
latest = now
source = WinEventLog:Security
sourcetype = WinEventLog:Security
index = main

breaker = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]

## replace timestamp 2010-06-16 18:35:22:743
token.0.token = ^\d{2}\/\d{2}\/\d{2,4}\s+\d{2}:\d{2}:\d{2}\s+[AaPp][Mm]
token.0.replacementType = timestamp
token.0.replacement = %Y-%m-%d %H:%M:%S

