<form>
  <label>Disable Untrusted Macros - Overview</label>
  <fieldset submitButton="true">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
    <input type="radio" token="showGuidance" searchWhenChanged="true">
      <label>Show Guidance</label>
      <choice value="true">On</choice>
      <choice value="false">Off</choice>
      <default>true</default>
      <initialValue>true</initialValue>
      <change>
        <condition value="true">
          <set token="showDescription">true</set>
          <set token="showHowToUse">true</set>
          <set token="showExampleSources">true</set>
        </condition>
        <condition>
          <unset token="showDescription"></unset>
          <unset token="showHowToUse"></unset>
          <unset token="showExampleSources"></unset>
        </condition>
      </change>
    </input>
  </fieldset>
  <row depends="$showDescription$">
    <panel>
      <title>Description</title>
      <html>
      <p>Configure Microsoft Office macro settings to block macros from the Internet, and only allow vetted macros either in ‘trusted locations’ with limited write access or digitally signed with a trusted certificate. <B>Why?</B> Microsoft Office macros can be used to deliver and execute malicious code on systems.
        </p>
    </html>
    </panel>
  </row>
  <row depends="$showHowToUse$">
    <panel>
      <title>How to Use This Dashboard</title>
      <html>
      <p>When reviewing this dashboard you should pay attention to the macros that are being allowed and ensuring that they have been appropariately vetted and exist in either 'trusted locations' or are appropriately digitally signed. </p>
    </html>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Distinct count of Trusted Locations by Office Application</title>
        <search>
          <query>`macro_index` sourcetype=WinRegistry key_path="*Trusted Locations*Path" 
| rex field=_raw "host\=\"(?&lt;host&gt;[\w\-]+)" 
| rex field=key_path "(?&lt;user&gt;lc\d+)" 
| rex field=key_path "Office\\\(?&lt;office_version&gt;[\d\.]+)" 
| rex field=key_path "\d{1,2}\.\d{1}\\\(?&lt;office_application&gt;[A-Za-z]+)" 
| eval office_version=case(office_version="11.0","Office 2003",office_version="12.0","Office 2007",office_version="14.0","Office 2010",office_version="15.0","Office 2013",office_version="16.0","Office 2016") 
| eval officeName=office_application + " " + office_version
| stats dc(data) as "Distinct Trusted Locations" by officeName
| rename data as "Trusted Location" office_application as "Office Application", office_version as "Office Version"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="height">186</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">1</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">large</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <table>
        <title>Macro Settings in Environment</title>
        <search>
          <query>`macro_index` sourcetype=WinRegistry key_path="*VBAWarnings"| rex field=_raw "host\=\"(?&lt;host&gt;[\w\-]+)" 
| rex field=key_path "(?&lt;sid&gt;S\-[\d\-]+)" 
| rex field=key_path "Office\\\(?&lt;office_version&gt;[\d\.]+)" 
| rex field=key_path "\d{1,2}\.\d{1}\\\(?&lt;office_application&gt;[A-Za-z]+)" 
| eval office_version=case(office_version="11.0","Office 2003",office_version="12.0","Office 2007",office_version="14.0","Office 2010",office_version="15.0","Office 2013",office_version="16.0","Office 2016") 
| eval officeName=office_application + " " + office_version
| eval vba_warning=case(data="0x00000004(4)", "Disable All VBA's without notification", data="0x00000003(3)", "Disable all macros except those digitally signed", data="0x00000002(2)", "Disable All macros with notification",  data="0x00000001(1)", "Enable All Macros")
| stats dc(sid) as "Distinct Users" by vba_warning, office_application
| rename  vba_warning as "Macro Setting" office_application as "Office Application", office_version as "Office Version"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>